{% extends "base.html" %}
{% load static %}
{% block title %}Produtos{% endblock %}
{% block content %}

<h2 class="area-title area-with-cart">
    √ÅREA DE PEDIDOS

    <div class="cart-header-icon">
        <span class="cart-icon">üõí</span>

        {% if cart_count > 0 %}
            <span class="cart-badge">
                {{ cart_count }}
            </span>
        {% endif %}
    </div>
</h2>


{% for cat in categories %}
<div class="x-cat">

    <div class="x-cat-head" onclick="toggleCat({{ cat.id }})">

      <img
        src="{% if cat.image %}{{ cat.image.url }}{% else %}{% static 'img/logo_xodo.png' %}{% endif %}"
        class="x-cat-icon"
        onerror="this.src='{% static 'img/logo_xodo.png' %}'"
      >

      <div>
        <div class="x-cat-name">{{ cat.name|upper }}</div>
        <div class="x-cat-count">{{ cat.products.count }} PRODUTOS</div>
      </div>

    </div>


  <div id="cat-body-{{ cat.id }}" class="x-cat-body">

    <div class="x-grid">

      {% for p in cat.products.all %}
      {% if p.active %}
      <form method="post"
            action="{% url 'q_products' %}"
            class="x-prod {% if p.image %}has-img{% else %}no-img{% endif %}">

        {% csrf_token %}
        <input type="hidden" name="product_id" value="{{ p.id }}">

        {% if p.image %}
          <img src="{{ p.image.url }}" class="x-prod-img">
        {% endif %}

        <div class="x-prod-name">
          {{ p.name|upper }}
        </div>

        <div class="x-qty">
          <button type="button" onclick="dec(this)">‚àí</button>
          <input type="number" name="qty" value="1" min="1">
          <button type="button" onclick="inc(this)">+</button>
        </div>

        <button type="submit" class="x-save">
          SALVAR
        </button>

      </form>
      {% endif %}
      {% endfor %}

    </div>

  </div>

</div>
{% endfor %}

<script>
function toggleCat(id){
  const el = document.getElementById("cat-body-"+id)
  el.style.display = el.style.display === "block" ? "none" : "block"
}

function inc(btn){
  const input = btn.parentElement.querySelector("input")
  input.value = parseInt(input.value || 1) + 1
}

function dec(btn){
  const input = btn.parentElement.querySelector("input")
  const v = parseInt(input.value || 1)
  if(v > 1) input.value = v - 1
}
</script>

{% endblock %}
