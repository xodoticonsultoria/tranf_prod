{% extends "base.html" %}
{% load static %}
{% block content %}

<h2 class="area-title">√ÅREA DE PEDIDOS</h2>

{% for c in categories %}
<div class="x-cat">

    <div class="x-cat-head" onclick="toggleCat({{ c.id }})">

        {% if c.image %}
            <img src="{{ c.image.url }}" class="x-cat-icon">
        {% else %}
            <img src="{% static 'img/cat-default.png' %}" class="x-cat-icon">
        {% endif %}

        <div>
            <div class="x-cat-name">{{ c.name|upper }}</div>
            <div class="x-cat-count">{{ c.products.count }} PRODUTOS</div>
        </div>

    </div>

    <div id="cat-{{ c.id }}" class="x-cat-body">
        <div class="x-grid">

        {% for p in c.products.all %}
        <form method="post" class="x-prod">
            {% csrf_token %}
            <input type="hidden" name="product_id" value="{{ p.id }}">

            {% if p.image %}
                <img src="{{ p.image.url }}" class="x-prod-img">
            {% else %}
                <img src="{% static 'img/prod-default.png' %}" class="x-prod-img">
            {% endif %}

            <div class="x-prod-name">{{ p.name }}</div>

            <div class="x-qty">
                <button type="button" onclick="dec(this)">-</button>
                <input type="number" name="qty" value="1" min="1">
                <button type="button" onclick="inc(this)">+</button>
            </div>

            <button class="x-add">Adicionar</button>
        </form>
        {% endfor %}

        </div>
    </div>

</div>
{% endfor %}

<script>
function toggleCat(id){
  const el = document.getElementById("cat-"+id)
  el.style.display = el.style.display === "block" ? "none" : "block"
}

function inc(btn){
  const input = btn.parentElement.querySelector("input")
  input.value = parseInt(input.value) + 1
}

function dec(btn){
  const input = btn.parentElement.querySelector("input")
  if(input.value > 1){
    input.value = parseInt(input.value) - 1
  }
}
</script>

{% endblock %}
