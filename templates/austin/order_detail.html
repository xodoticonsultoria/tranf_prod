{% extends "base.html" %}
{% block title %}Austin - Pedido #{{ order.id }}{% endblock %}

{% block content %}

<h2 class="area-title">
  Austin Pedido #{{ order.id }}
</h2>

<div class="order-status-box">
  <span class="order-status-label">Status:</span>
  <span class="order-status-badge {{ order.status }}">
    {{ order.get_status_display|upper }}
  </span>
</div>

<div class="order-table-wrap">

  <table class="order-table">

    <thead>
      <tr>
        <th>Produto</th>
        <th>Pedido</th>
        <th>Enviado</th>
        <th>Ação</th>
      </tr>
    </thead>

    <tbody>

      {% for it in items %}
      <tr>

        <td class="prod-name">
          {{ it.product.name|upper }}
          <span class="muted">({{ it.product.sku }})</span>
        </td>

        <td>{{ it.qty_requested }}</td>

        <td>
          {% if order.status == "PICKING" %}
            <input type="number"
                   name="sent_{{ it.id }}"
                   min="0"
                   value="{{ it.qty_sent }}"
                   class="qty-input">
          {% else %}
            {{ it.qty_sent }}
          {% endif %}
        </td>

        <td>
          {% if order.status == "PICKING" %}
            <a href="{% url 'a_item_ok' order.id it.id %}"
               class="btn-ok">
              OK
            </a>
          {% endif %}
        </td>

      </tr>
      {% endfor %}

    </tbody>

  </table>

</div>

<!-- OBSERVAÇÃO -->

<div class="order-notes-box">
  <h3>Observação (Austin)</h3>

  {% if order.status == "PICKING" %}
    <form method="post">
      {% csrf_token %}
      <textarea name="notes_from_austin"
                placeholder="Ex: faltou rosquinha, enviando 3...">
        {{ order.notes_from_austin }}
      </textarea>

      <div style="text-align:right; margin-top:10px;">
        <button class="x-save">Salvar observação</button>
      </div>
    </form>
  {% else %}
    <div class="order-note-display">
      {{ order.notes_from_austin|default:"(sem observações)" }}
    </div>
  {% endif %}
</div>

<!-- BOTÕES -->

<div style="text-align:center; margin-top:30px;">

  {% if order.status == "SUBMITTED" %}
    <a href="{% url 'a_start_picking' order.id %}"
       class="x-save"
       onclick="return confirm('Iniciar separação?');">
       INICIAR SEPARAÇÃO
    </a>
  {% endif %}

  {% if order.status == "PICKING" %}
    <a href="{% url 'a_dispatch' order.id %}"
       class="x-save"
       onclick="return confirm('Despachar pedido?');">
       DESPACHAR
    </a>
  {% endif %}

  <br><br>

    <a href="{% url 'a_orders' %}" class="x-side-btn btn-small">Voltar</a>

</div>

{% endblock %}
