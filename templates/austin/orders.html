{% extends "base.html" %}
{% block title %}Austin - Pedidos{% endblock %}

{% block content %}

<div class="card header-card">
  <div class="header-row">
    <div>
      <h2 style="margin:0;">Austin • Pedidos</h2>
      <p class="muted" style="margin:.35rem 0 0;">
        Abra um pedido para iniciar separação e definir o que será enviado.
      </p>
    </div>

    <div class="header-actions">
      <span class="pill pill-attn">
        Novos <span class="badge" id="badgeAustin">0</span>
      </span>
      <button class="btn btn-secondary" type="button" onclick="window.location.reload()">
        Atualizar
      </button>
    </div>
  </div>
</div>

<div class="grid-orders">
  {% for o in orders %}
    <div class="card order-card">
      <div class="order-top">
        <div class="order-id">
          <div class="muted" style="font-size:.85rem;">Pedido</div>
          <div style="font-weight:800; font-size:1.25rem;">#{{ o.id }}</div>
        </div>

        <div class="order-status">
          <span class="pill pill-gray">{{ o.status }}</span>
        </div>
      </div>

      <div class="order-meta">
        <div class="meta-item">
          <div class="muted meta-label">Criado em</div>
          <div class="meta-value">{{ o.created_at }}</div>
        </div>

        <div class="meta-item">
          <div class="muted meta-label">De</div>
          <div class="meta-value">{{ o.from_branch }}</div>
        </div>
      </div>

      <div class="order-actions">
        <a class="btn" href="/austin/pedidos/{{ o.id }}/">Abrir pedido</a>
      </div>
    </div>
  {% empty %}
    <div class="card">
      <h3 style="margin:0 0 .35rem;">Nenhum pedido</h3>
      <p class="muted" style="margin:0;">Quando chegar um pedido de Queimados, ele vai aparecer aqui.</p>
    </div>
  {% endfor %}
</div>

<style>
  /* ===== layout ===== */
  .header-row{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:1rem;
    flex-wrap:wrap;
  }
  .header-actions{
    display:flex;
    gap:.6rem;
    align-items:center;
    flex-wrap:wrap;
  }

  .grid-orders{
    display:grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap:1rem;
    margin-top:1rem;
  }

  .order-card{
    padding:1rem;
  }
  .order-top{
    display:flex;
    align-items:flex-start;
    justify-content:space-between;
    gap:1rem;
    margin-bottom:.75rem;
  }
  .order-meta{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:.75rem;
    margin: .25rem 0 1rem;
  }
  .meta-label{
    font-size:.8rem;
  }
  .meta-value{
    font-weight:700;
  }
  .order-actions{
    display:flex;
    justify-content:flex-end;
  }

  /* ===== pills/badges (se não existir no seu css, isso garante) ===== */
  .pill{
    display:inline-flex;
    align-items:center;
    gap:.4rem;
    padding:.35rem .6rem;
    border-radius:999px;
    font-weight:700;
    font-size:.85rem;
    background:#eee;
  }
  .pill-attn{
    background:#fff3cd;
    border:1px solid #ffe69c;
  }
  .badge{
    display:inline-flex;
    min-width: 22px;
    height: 22px;
    border-radius: 999px;
    align-items:center;
    justify-content:center;
    font-weight:800;
    font-size:.85rem;
    background:#dc3545;
    color:#fff;
    padding:0 .35rem;
    line-height:1;
  }

  /* ===== responsivo ===== */
  @media (max-width: 980px){
    .grid-orders{ grid-template-columns: 1fr; }
    .order-actions{ justify-content:stretch; }
    .order-actions .btn{ width:100%; text-align:center; }
  }
</style>

<script>
(function(){
  // Atualiza badge "Novos" (AJAX)
  const url = "/austin/api/badge/";
  const el = document.getElementById("badgeAustin");

  async function refreshBadge(){
    try{
      const res = await fetch(url, {headers: {"X-Requested-With":"XMLHttpRequest"}});
      if(!res.ok) return;
      const data = await res.json();
      if(el) el.textContent = data.count ?? 0;
    }catch(e){}
  }

  refreshBadge();
  setInterval(refreshBadge, 8000); // 8s
})();
</script>

{% endblock %}
